import { State, Tile } from "./world"


const LEVEL_ENEMY = `
####################
######.#############
######..############
######...###########
######....##########
######.....#########
######.....#########
##...#.....#####...#
##.s.............!.#
##...#AAAAA#####...#
####################
####################
####################
####################
####################
####################
####################
####################
`

const LEVEL1 = `
####################
####################
####################
####################
####################
####################
####################
#####.....#....#####
#####.s...^....#####
#####.....#....#####
##############x#####
###!.#########.#####
####.###++.###A#####
####.++^.#.^...#####
########...#########
####################
####################
####################
`

const LEVEL2 = `
####################
####.......#########
####.s.....###.#####
####.......^x...####
####...x...#....####
#####......###^#####
#####..........A####
####............####
####......###...####
####A.+...###...####
####............####
########^###########
######.....#.....###
######.....#.....###
######.A+..^..!.+###
######.....#.....###
######.....#.....###
####################
`

const LEVEL3 = `
####################
#...............x.##
#+#.......!.....#.##
#+#.###########.#.##
#+#..^........^.#..#
#+########^#######.#
#+^..............^.#
#.###.##....##.###.#
#...^.#......#.^...#
###.#.#..s...#.#####
#...#.########.#..x#
#.#.#..........#.#.#
#.#.#..#######.#.#.#
#.#.^..#.....#.^.#.#
#.#.#....#.#...#.#.#
#.#.######.#####.#.#
#......^..........x#
####################
`

const LEVEL4 = `
####################
####################
#...............x..#
#^##.#####.####.##+#
#+##.#####.####^##+#
#.##x#####!####.##+#
#.##.##########.##.#
#+##x##########.##.#
#.##.##########.##.#
#.##.##########.##.#
#.##x##########.##.#
#+##.##########.##.#
#.##.##########.##.#
#.##.##########.##.#
#+##.###....###.##.#
#......x..s.x......#
########....########
####################
`


const LEVEL5 = `
####################
#..................#
#.!.......!........#
#..................#
#.....!.......!....#
#..................#
#..................#
####^#########^#####
####^#########^#####
####^#########^#####
#..+...........+...#
#..................#
#..................#
#........s.........#
#..................#
#..................#
#..................#
####################
`

const LEVEL6 = `
####################
####################
####################
####################
####################
####################
####################
####.+.#####.x.#####
#s.+.#.......#....!#
####.x.#####.+.#####
####################
####################
####################
####################
####################
####################
####################
####################
`

const END = `
####################
#.###.#...##.#.#####
##.#.##.#.##.#.#####
###.###.#.##.#.#####
###.###.s.##...#####
#################.##
#.#.#.##.##.##.##.##
#.#.#.##.##..#.##.##
#.#.#.##.##.#..#####
#.....##.##.##.##+##
####################
####################
####################
####################
####################
####################
####################
####################
`


const LOOPS = `
####################
#########s##########
#########x##########
#########.##########
#########.##########
#########.##########
########++.#########
#######+++++########
######+.+++++#######
######++++.++#######
######+.+++++#######
######++++++.#######
#########.##########
#########!##########
####################
####################
####################
####################
`

const ROOMS = `
####################
#......#############
#..s...#############
#....+.^...^......##
#......#####......##
####^#######......##
####x#######......##
####.#######......##
####^#########^#####
###.............####
###.+...........####
###.............####
###########....#####
#.....#.+.#....#####
#..!..^.#.^....#####
#.....#+.+#....#####
#.....##############
####################
`

const LEVELS = [
    LEVEL_ENEMY,
   LEVEL1, LEVEL2, ROOMS,LOOPS, LEVEL4, LEVEL5, LEVEL6, 
//    LEVEL7,
   LEVEL3, END
]

const CHAR_MAP: { [id: string]: Tile } = {
    "#": Tile.WALL,
    ".": Tile.EMPTY,
    "^": Tile.DOOR_CLOSED,
    "!": Tile.FLAG,
    "x": Tile.MULTIPLY,
    "+": Tile.PLUS
}

export function loadLevel(state: State, levelNum: number) {
    const level = LEVELS[levelNum % LEVELS.length];
    state.entities = [];
    if (level) {
        const lines = level.split(/[\r\n]+/).map(a => a.trim()).filter(a => a.length > 0);
        lines.forEach((line, y) => {
            line.split("").forEach((char, x) => {
                state.tiles.set(x, y, CHAR_MAP[char] | Tile.EMPTY);
                if (char == "s") {
                    state.path = [[x, y]]
                }
                if (char == "A") {
                    state.entities.push({
                        type: "vertical",
                        down: true,
                        path: [[x,y]],
                        pos: [x, y]
                    });
                }
            })
        })
    }
}